// Corrección para ajuste responsive del canvas y eventos touch
function resizeCanvas() {
  const parent = canvas.parentElement;
  const PIXEL_RATIO = window.devicePixelRatio || 1;
  canvas.width = parent.offsetWidth * PIXEL_RATIO;
  canvas.height = (parent.offsetWidth * 0.5) * PIXEL_RATIO; // Proporción 2:1
  canvas.style.width = parent.offsetWidth + 'px';
  canvas.style.height = (parent.offsetWidth * 0.5) + 'px';
  // Reinicia el contexto para nuevo tamaño
  ctx.setTransform(1, 0, 0, 1, 0, 0);
  ctx.scale(PIXEL_RATIO, PIXEL_RATIO);
  ctx.lineWidth = 2;
  ctx.lineJoin = 'round';
  ctx.lineCap = 'round';
  ctx.strokeStyle = '#003366';
}
window.addEventListener('resize', resizeCanvas);
window.addEventListener('orientationchange', resizeCanvas); // móvil

// Ejecuta ajuste inicial al cargar
resizeCanvas();

// Eventos táctiles y de mouse compatibles
canvas.addEventListener('mousedown', (e) => {
  isDrawing = true;
  lastPosition = getMousePos(e);
});
canvas.addEventListener('mousemove', (e) => {
  if (!isDrawing) return;
  const currentPosition = getMousePos(e);
  drawLine(lastPosition.x, lastPosition.y, currentPosition.x, currentPosition.y);
  lastPosition = currentPosition;
  signatureDataUrl = canvas.toDataURL('image/png');
});
canvas.addEventListener('mouseup', () => isDrawing = false);
canvas.addEventListener('mouseleave', () => isDrawing = false);

canvas.addEventListener('touchstart', (e) => {
  e.preventDefault();
  isDrawing = true;
  lastPosition = getTouchPos(e);
}, { passive: false });
canvas.addEventListener('touchmove', (e) => {
  e.preventDefault();
  if (!isDrawing) return;
  const currentPosition = getTouchPos(e);
  drawLine(lastPosition.x, lastPosition.y, currentPosition.x, currentPosition.y);
  lastPosition = currentPosition;
  signatureDataUrl = canvas.toDataURL('image/png');
}, { passive: false });
canvas.addEventListener('touchend', () => isDrawing = false, { passive: false });

function getMousePos(e) {
  const rect = canvas.getBoundingClientRect();
  return { x: e.clientX - rect.left, y: e.clientY - rect.top };
}
function getTouchPos(e) {
  const rect = canvas.getBoundingClientRect();
  return { x: e.touches[0].clientX - rect.left, y: e.touches[0].clientY - rect.top };
}
