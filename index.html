<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Consentimiento Informado</title>
  <style>
    body { margin: 20px; font-family: Arial, sans-serif; }
    .container { max-width: 500px; margin: 0 auto; }
    .firma-container { margin-top: 20px; }
    canvas#firma { width: 100%; max-width: 350px; height: 150px; border: 1px solid #888; background: #fff; touch-action: none; }
    .terms { margin-top: 20px; }
    /* Corregir posibles overflow o height fijos */
    html, body { height: auto; overflow-y: auto; }
    /* Evitar overlays o estilos que bloqueen el checkbox */
    input[type="checkbox"] { position: relative; z-index: 1; }
  </style>
</head>
<body>
  <div class="container">
    <h2>Por favor, completa tus datos para iniciar el proceso.</h2>
    <p>
      Yo, manifiesto mi consentimiento libre, voluntario y consciente para recibir servicios de psicología por parte de Jorge Arango Castaño, de acuerdo con los siguientes términos:
    </p>
    <p>
      El objetivo de este proceso es la exploración y orientación en mi propósito y proyecto de vida, abordando las diversas áreas de mi existencia que puedan estar afectando mi bienestar psicológico y emocional. Se utilizarán técnicas de la psicología humanista-existencial y Programación Neurolingüística (PNL) para facilitar mi autodescubrimiento y crecimiento personal.
    </p>
    <p>
      Soy consciente de que la terapia es un <strong>proyecto</strong> con un inicio y un fin, y que su éxito depende de mi compromiso y participación activa. Acepto la asignación de tareas inter-sesiones y entiendo que la falta de cumplimiento en repetidas ocasiones podría ser motivo para revisar el proceso, tal como se me ha explicado.
    </p>
    <p>
      Autorizo el tratamiento de mis datos personales y sensibles (incluida mi información de salud mental) de acuerdo con la Ley 1581 de 2012 y el Decreto 1377 de 2013, así como con la Política de Protección de Datos de Jorge Arango Castaño - Caminos del Ser. Estos datos serán utilizados exclusivamente para fines terapéuticos, de seguimiento y estadísticos anonimizados. En ningún caso se compartirán con fines comerciales.
    </p>
    <p>
      Entiendo que puedo ejercer mis derechos de acceso, corrección, supresión y revocación de mi autorización en cualquier momento, de acuerdo con la legislación vigente.
    </p>
    <p>
      Al firmar digitalmente y presionar el botón de "Enviar", confirmo que he leído, entendido y aceptado todos los términos del presente consentimiento informado.
    </p>
    <p>Tu consentimiento ha sido registrado exitosamente. Te esperamos en tu sesión.</p>

    <div class="terms">
      <input type="checkbox" id="consentimiento" name="consentimiento">
      <label for="consentimiento">He leído y acepto los términos y condiciones anteriormente descritos.</label>
    </div>

    <div class="firma-container">
      <p>Firma aquí:</p>
      <canvas id="firma" width="350" height="150"></canvas>
      <button id="limpiarFirma" type="button">Limpiar firma</button>
    </div>

    <button type="submit" id="enviar">Enviar</button>
  </div>

  <script>
    const canvas = document.getElementById('firma');
    const ctx = canvas.getContext('2d');
    let dibujando = false, x = 0, y = 0;

    // Función para obtener coordenadas en mouse o touch
    function getXY(e) {
      let rect = canvas.getBoundingClientRect();
      if (e.touches) {
        // Evento touch
        return {
          x: e.touches[0].clientX - rect.left,
          y: e.touches[0].clientY - rect.top
        };
      } else {
        // Evento mouse
        return {
          x: e.offsetX,
          y: e.offsetY
        };
      }
    }

    // Eventos mouse
    canvas.addEventListener('mousedown', e => {
      dibujando = true;
      const pos = getXY(e);
      x = pos.x; y = pos.y;
    });
    canvas.addEventListener('mousemove', e => {
      if (!dibujando) return;
      const pos = getXY(e);
      ctx.beginPath();
      ctx.moveTo(x, y);
      ctx.lineTo(pos.x, pos.y);
      ctx.stroke();
      x = pos.x; y = pos.y;
    });
    canvas.addEventListener('mouseup', e => dibujando = false);
    canvas.addEventListener('mouseout', e => dibujando = false);

    // Eventos touch
    canvas.addEventListener('touchstart', e => {
      e.preventDefault();
      dibujando = true;
      const pos = getXY(e);
      x = pos.x; y = pos.y;
    }, {passive: false});
    canvas.addEventListener('touchmove', e => {
      if (!dibujando) return;
      e.preventDefault();
      const pos = getXY(e);
      ctx.beginPath();
      ctx.moveTo(x, y);
      ctx.lineTo(pos.x, pos.y);
      ctx.stroke();
      x = pos.x; y = pos.y;
    }, {passive: false});
    canvas.addEventListener('touchend', e => {
      dibujando = false;
    }, {passive: false});

    // Botón limpiar firma
    document.getElementById('limpiarFirma').onclick = () => {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
    };

    // Botón enviar: verifica que checkbox esté marcado
    document.getElementById('enviar').onclick = function(e){
      if(!document.getElementById('consentimiento').checked){
        alert('Debes aceptar los términos para continuar.');
        e.preventDefault();
        return false;
      }
      // Aquí puedes agregar lógica para procesar la firma o los datos antes de enviar
    };
  </script>

</body>
</html>
