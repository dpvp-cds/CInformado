<!DOCTYPE html>
<html lang="es" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consentimiento Informado - Caminos del Ser</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Poppins', sans-serif; background-color: #F8F7F2; color: #4A4A4A; }
        .btn-brand { background-color: #003366; color: white; padding: 12px 30px; border-radius: 9999px; font-weight: 600; transition: all 0.3s ease; }
        .btn-brand:hover { background-color: #002244; }
        .card { background-color: white; border-radius: 16px; padding: 2.5rem; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.05); }
        .input-styled, .select-styled { border: 1px solid #d1d5db; border-radius: 8px; padding: 10px 15px; width: 100%; }
        .input-styled:focus, .select-styled:focus { outline: none; border-color: #003366; box-shadow: 0 0 0 2px rgba(0, 51, 102, 0.2); }
        .section-container { transition: max-height 0.7s ease-in-out, opacity 0.5s ease; max-height: 0; opacity: 0; overflow: hidden; }
        .section-container.open { max-height: 4000px; opacity: 1; }
    </style>
</head>
<body>
    <header class="bg-white shadow-sm">
        <div class="container mx-auto px-6 py-2">
            <img src="logoprincipal.png" alt="Caminos del Ser Logo" class="h-11 w-auto">
        </div>
    </header>

    <main class="container mx-auto px-6 py-12">
        <div class="max-w-4xl mx-auto">
            <h1 class="text-3xl md:text-4xl font-bold text-center mb-4">Consentimiento Informado Digital</h1>
            <p class="text-center text-gray-600 mb-8">Por favor, completa tus datos para generar y aceptar los términos del servicio.</p>

            <form id="demographicsForm" class="card space-y-6">
                <h2 class="text-2xl font-bold border-b pb-3">1. Información del Paciente</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div><label for="fechaDiligenciamiento" class="block mb-2 font-medium">Fecha de Diligenciamiento</label><input type="date" id="fechaDiligenciamiento" name="fechaDiligenciamiento" class="input-styled bg-gray-100" readonly></div>
                    <div><label for="nombreCompleto" class="block mb-2 font-medium">Nombre Completo</label><input type="text" id="nombreCompleto" name="nombreCompleto" class="input-styled" required></div>
                    <div><label for="fechaNacimiento" class="block mb-2 font-medium">Fecha de Nacimiento</label><input type="date" id="fechaNacimiento" name="fechaNacimiento" class="input-styled" required></div>
                    <div><label for="edad" class="block mb-2 font-medium">Edad</label><input type="text" id="edad" name="edad" class="input-styled bg-gray-100" readonly></div>
                    <div>
                        <label for="pais" class="block mb-2 font-medium">País de Residencia</label>
                        <select id="pais" name="pais" class="select-styled" required></select>
                    </div>
                    <div id="tipoDocumentoContainer">
                        <label for="tipoDocumento" class="block mb-2 font-medium">Tipo de Documento</label>
                        <select id="tipoDocumento" name="tipoDocumento" class="select-styled" required></select>
                    </div>
                    <div><label for="documentoIdentidad" class="block mb-2 font-medium">Documento de Identidad</label><input type="text" id="documentoIdentidad" name="documentoIdentidad" class="input-styled" required></div>
                    <div><label for="telefonoContacto" class="block mb-2 font-medium">Teléfono de Contacto</label><input type="tel" id="telefonoContacto" name="telefonoContacto" class="input-styled" required></div>
                    <div class="md:col-span-2"><label for="email" class="block mb-2 font-medium">Correo Electrónico</label><input type="email" id="email" name="email" class="input-styled" required></div>
                    <div><label for="contactoEmergenciaNombre" class="block mb-2 font-medium">Nombre Contacto de Emergencia</label><input type="text" id="contactoEmergenciaNombre" name="contactoEmergenciaNombre" class="input-styled" required></div>
                    <div><label for="contactoEmergenciaTelefono" class="block mb-2 font-medium">Teléfono Contacto de Emergencia</label><input type="tel" id="contactoEmergenciaTelefono" name="contactoEmergenciaTelefono" class="input-styled" required></div>
                </div>

                <div id="adultoResponsableContainer" class="hidden pt-6 border-t mt-6 space-y-6">
                    <h3 class="text-xl font-semibold text-red-700">Información del Adulto Responsable</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div><label for="nombreAcudiente" class="block mb-2 font-medium">Nombre Completo del Acudiente</label><input type="text" id="nombreAcudiente" name="nombreAcudiente" class="input-styled"></div>
                        <div>
                            <label for="tipoAcudiente" class="block mb-2 font-medium">Tipo de Acudiente</label>
                            <select id="tipoAcudiente" name="tipoAcudiente" class="select-styled">
                                <option value="">Seleccione...</option>
                                <option value="Papá">Papá</option>
                                <option value="Mamá">Mamá</option>
                                <option value="Abuelo">Abuelo</option>
                                <option value="Abuela">Abuela</option>
                                <option value="Tío">Tío</option>
                                <option value="Tía">Tía</option>
                                <option value="Hermano">Hermano</option>
                                <option value="Hermana">Hermana</option>
                                <option value="Representante Legal">Representante Legal</option>
                                <option value="Tutor Legal">Tutor Legal</option>
                            </select>
                        </div>
                        <div class="md:col-span-2"><label for="documentoAcudiente" class="block mb-2 font-medium">Documento de Identidad del Acudiente</label><input type="text" id="documentoAcudiente" name="documentoAcudiente" class="input-styled"></div>
                    </div>
                </div>
                <div id="form-error" class="text-red-600 text-center font-semibold hidden">Por favor, completa todos los campos requeridos.</div>
                <div class="text-center pt-4">
                    <button type="button" id="continueButton" class="btn-brand">Continuar a la Firma</button>
                </div>
            </form>
        </div>
    </main>

    <footer class="bg-[#1a1a1a] text-white py-8 mt-16">
        <div class="container mx-auto text-center">
            <p class="text-gray-400">&copy; 2025 Jorge Arango Castaño - Caminos del Ser. Todos los derechos reservados.</p>
            <div class="mt-4">
                <a href="https://www.caminosdelser.co/politicadatos.html" target="_blank" class="text-sm text-gray-500 hover:text-gray-300 transition-colors">Política de tratamiento de datos</a>
                <span class="text-gray-600 mx-2">|</span>
                <a href="login.html" class="text-sm text-gray-500 hover:text-gray-300 transition-colors">Acceso Terapeuta</a>
            </div>
        </div>
    </footer>
    
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // --- INICIALIZACIÓN DE CAMPOS ---
        const fechaDiligenciamiento = document.getElementById('fechaDiligenciamiento');
        fechaDiligenciamiento.valueAsDate = new Date();

        const paisSelect = document.getElementById('pais');
        const tipoDocumentoSelect = document.getElementById('tipoDocumento');
        const fechaNacimientoInput = document.getElementById('fechaNacimiento');
        const edadInput = document.getElementById('edad');
        const adultoResponsableContainer = document.getElementById('adultoResponsableContainer');
        const continueButton = document.getElementById('continueButton');
        const form = document.getElementById('demographicsForm');
        const formError = document.getElementById('form-error');

        const paises = ["Seleccione un país", "Colombia", "Estados Unidos", "Canadá", "México", "Argentina", "Bolivia", "Brasil", "Chile", "Ecuador", "Paraguay", "Perú", "Uruguay", "Venezuela", "Costa Rica", "El Salvador", "Guatemala", "Honduras", "Nicaragua", "Panamá", "Otro"];
        paises.forEach(pais => {
            const option = document.createElement('option');
            option.value = pais.toLowerCase().replace(/ /g, '_');
            option.textContent = pais;
            if (pais === "Seleccione un país") option.value = "";
            paisSelect.appendChild(option);
        });

        // --- LÓGICA DE FORMULARIO DINÁMICO ---
        function calcularEdad(fechaNacimiento) {
            const hoy = new Date();
            const nacimiento = new Date(fechaNacimiento);
            let edad = hoy.getFullYear() - nacimiento.getFullYear();
            const mes = hoy.getMonth() - nacimiento.getMonth();
            if (mes < 0 || (mes === 0 && hoy.getDate() < nacimiento.getDate())) {
                edad--;
            }
            return edad;
        }

        function actualizarTipoDocumento() {
            const pais = paisSelect.value;
            const edad = parseInt(edadInput.value, 10);
            tipoDocumentoSelect.innerHTML = ''; 

            let opciones = [];
            if (edad < 18 && pais === 'colombia') {
                opciones = ['Tarjeta de Identidad'];
            } else if (pais === 'colombia') {
                opciones = ['Cédula de Ciudadanía', 'Cédula de Extranjería', 'Pasaporte'];
            } else {
                opciones = ['Documento Nacional de Identidad', 'Pasaporte', 'Otro'];
            }

            opciones.forEach(op => {
                const option = document.createElement('option');
                option.value = op.toLowerCase().replace(/ /g, '_');
                option.textContent = op;
                tipoDocumentoSelect.appendChild(option);
            });
        }

        fechaNacimientoInput.addEventListener('change', function() {
            if (this.value) {
                const edad = calcularEdad(this.value);
                edadInput.value = edad;
                adultoResponsableContainer.classList.toggle('hidden', edad >= 18);
                // Requerir campos de acudiente solo si es menor de edad
                document.getElementById('nombreAcudiente').required = edad < 18;
                document.getElementById('tipoAcudiente').required = edad < 18;
                document.getElementById('documentoAcudiente').required = edad < 18;
                actualizarTipoDocumento();
            }
        });

        paisSelect.addEventListener('change', actualizarTipoDocumento);

        // --- LÓGICA DE GUARDADO Y REDIRECCIÓN (LA PIEZA CLAVE CORREGIDA) ---
        continueButton.addEventListener('click', function() {
            formError.classList.add('hidden');
            if (!form.checkValidity()) {
                form.reportValidity();
                formError.classList.remove('hidden');
                return;
            }

            // 1. Recolectar todos los datos del formulario
            const formData = new FormData(form);
            const datosDemograficos = {};
            formData.forEach((value, key) => {
                datosDemograficos[key] = value;
            });
            
            // 2. Guardar los datos en sessionStorage
            try {
                sessionStorage.setItem('consentimiento_demograficos', JSON.stringify(datosDemograficos));
                console.log("Datos guardados en sessionStorage.");
                
                // 3. Redirigir a la página de la firma
                window.location.href = 'firma.html';

            } catch (error) {
                console.error("Error al guardar en sessionStorage:", error);
                formError.textContent = "Hubo un error al preparar los datos. Por favor, intenta de nuevo.";
                formError.classList.remove('hidden');
            }
        });
    });
    </script>
</body>
</html>
