<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Consentimiento Informado</title>
  <style>
    body { margin: 20px; font-family: Arial, sans-serif; }
    .container { max-width: 500px; margin: 0 auto; }
    .firma-container { margin-top: 20px; }
    canvas#firma { width: 100%; max-width: 350px; height: 150px; border: 1px solid #888; background: #fff; touch-action: none; }
    .terms { margin-top: 20px; }
    /* <--- Corregir posibles overflow o height fijos --> */
    html, body { height: auto; overflow-y: auto; }
    /* Evitar overlays o estilos que bloqueen el checkbox */
    input[type="checkbox"] { position: relative; z-index: 1; }
  </style>
</head>
<body>
  <div class="container">
    <h2>Por favor, completa tus datos para iniciar el proceso.</h2>
    <p>
      Yo, manifiesto mi consentimiento libre, voluntario y consciente para recibir servicios de psicología por parte de Jorge Arango Castaño...
      <!-- El texto original completo aquí -->
    </p>
    <!-- ... Aquí el resto de los términos de consentimiento ... -->
    <div class="terms">
      <input type="checkbox" id="consentimiento" name="consentimiento">
      <label for="consentimiento">He leído y acepto los términos y condiciones anteriormente descritos.</label>
    </div>
    <div class="firma-container">
      <p>Firma aquí:</p>
      <canvas id="firma" width="350" height="150"></canvas>
      <button id="limpiarFirma" type="button">Limpiar firma</button>
    </div>
    <button type="submit" id="enviar">Enviar</button>
  </div>
  <script>
    /* Firma: compatible mouse y touch */
    const canvas = document.getElementById('firma');
    const ctx = canvas.getContext('2d');
    let dibujando = false, x = 0, y = 0;

    // Desktop
    canvas.addEventListener('mousedown', e => {
      dibujando = true;
      x = e.offsetX;
      y = e.offsetY;
    });
    canvas.addEventListener('mousemove', e => {
      if (!dibujando) return;
      ctx.beginPath();
      ctx.moveTo(x, y);
      ctx.lineTo(e.offsetX, e.offsetY);
      ctx.stroke();
      x = e.offsetX; y = e.offsetY;
    });
    canvas.addEventListener('mouseup', e => dibujando = false);
    canvas.addEventListener('mouseout', e => dibujando = false);

    // Móvil
    canvas.addEventListener('touchstart', e => {
      if (e.touches.length == 1) {
        const rect = canvas.getBoundingClientRect();
        x = e.touches.clientX - rect.left;
        y = e.touches.clientY - rect.top;
        dibujando = true;
      }
    });
    canvas.addEventListener('touchmove', e => {
      if (!dibujando) return;
      e.preventDefault();
      const rect = canvas.getBoundingClientRect();
      const nx = e.touches.clientX - rect.left;
      const ny = e.touches.clientY - rect.top;
      ctx.beginPath();
      ctx.moveTo(x, y);
      ctx.lineTo(nx, ny);
      ctx.stroke();
      x = nx; y = ny;
    }, {passive: false});
    canvas.addEventListener('touchend', e => dibujando = false);

    // Limpiar firma
    document.getElementById('limpiarFirma').onclick = () => {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
    };

    // Botón enviar: verifica que el checkbox esté marcado
    document.getElementById('enviar').onclick = function(e){
      if(!document.getElementById('consentimiento').checked){
        alert('Debes aceptar los términos para continuar.');
        e.preventDefault();
        return false;
      }
      // Si necesitas obtener la imagen de la firma:
      // const firmaDataURL = canvas.toDataURL();
    };
  </script>
</body>
</html>
